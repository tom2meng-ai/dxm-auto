# 店小秘 SKU 自动配对系统 - 需求文档

> 版本：v1.0  
> 日期：2026-01-21  
> 状态：需求确认中

---

## 一、项目背景

### 1.1 业务场景
- **店铺类型**：Shopify 定制首饰店（项链、手链）
- **ERP系统**：店小秘 VIP2 版本
- **日订单量**：100-1000单/天
- **核心问题**：定制产品的 SKU 配对需要大量手动操作

### 1.2 当前痛点
| 痛点 | 描述 |
|------|------|
| 重复劳动 | 每个定制订单都需要手动创建SKU、手动配对 |
| 效率低下 | 每单配对需要多次点击，日均耗时数小时 |
| 容易出错 | 手动操作容易选错SKU或漏配 |
| 现有工具不稳定 | Comet、Atlas等AI浏览器经常中断，需反复确认 |

---

## 二、目标工作流

### 2.1 期望的自动化流程

```
┌─────────────────────────────────────────────────────────────┐
│                     目标工作流                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  步骤1: 导出订单 Excel                                       │
│         - 从店小秘导出待处理的定制订单                        │
│         - 包含：平台SKU、Name1、Name2、盒子类型等             │
│         ↓                                                   │
│  步骤2: 自动生成建库 Excel                                   │
│         - 脚本自动解析订单数据                               │
│         - 生成新SKU：Michael-{产品号}-{日期}-{Name1}+{Name2} │
│         - 自动添加对应的卡片SKU                              │
│         - 如果是LED盒子，添加红盒SKU                         │
│         ↓                                                   │
│  步骤3: 批量导入建库                                         │
│         - 将生成的Excel导入店小秘商品管理                     │
│         - 一次性完成所有新SKU的创建                          │
│         ↓                                                   │
│  步骤4: 一键自动配对                                         │
│         - 运行Playwright脚本                                │
│         - 自动遍历未配对订单                                 │
│         - 根据Name1+Name2自动搜索并配对对应SKU               │
│         - 全程无需手动干预                                   │
│         ↓                                                   │
│  ✅ 完成！所有订单自动匹配                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 预期效果
- **时间节省**：从数小时降低到几分钟
- **准确率**：消除手动操作错误
- **无需反复确认**：脚本自动执行，不中断

---

## 三、数据规则

### 3.1 平台SKU结构（Shopify）

```
B09-B-Engraved-MAN10-whitebox
│    │    │       │      │
│    │    │       │      └── 盒子类型
│    │    │       │          - whitebox = 白盒（默认，不需要额外操作）
│    │    │       │          - ledbox = 红盒（需要添加红盒SKU）
│    │    │       │
│    │    │       └── 卡片代码（如 MAN10, D17, M58 等）
│    │    │           - 需要根据对应表添加卡片SKU
│    │    │
│    │    └── 定制类型
│    │        - Engraved = 定制（需要创建新SKU）
│    │        - 非Engraved = 非定制（已有SKU映射，无需处理）
│    │
│    └── 颜色代码
│        - B = Black
│        - G = Gold
│        - S = Silver
│        - 等...
│
└── 产品编号（如 B09, J20, J02 等）
```

### 3.2 店小秘新SKU生成规则

```
格式：Michael-{产品编号}-{日期MMDD}-{Name1}+{Name2}

示例：
├── 平台SKU: J20-G-engraved-D17-whitebox
├── Name 1: Xaviar
├── Name 2: Suzi
├── 创建日期: 01月21日
│
└── 生成SKU: Michael-J20-0121-Xaviar+Suzi
```

### 3.3 需要额外添加的SKU

| 条件 | 需要添加的SKU | 说明 |
|------|--------------|------|
| 卡片代码存在 | 根据卡片对应表 | 如 MAN10 → Michael-To My Man CARD? |
| 盒子类型 = ledbox | Michael-RED BOX | 红色LED盒子 |
| 盒子类型 = whitebox | 无需添加 | 默认已包含白盒 |

### 3.4 卡片对应表（待补充）

| Shopify卡片代码 | 店小秘卡片SKU |
|----------------|---------------|
| MAN1 | 待确认 |
| MAN10 | 待确认 |
| D17 | 待确认 |
| M58 | 待确认 |
| DAD1 | 待确认 |
| ... | ... |

> ⚠️ **待用户提供完整的卡片对应表**

---

## 四、技术方案

### 4.1 方案概述

| 模块 | 技术选型 | 说明 |
|------|----------|------|
| Excel生成 | Python + pandas/openpyxl | 解析订单数据，生成建库Excel |
| 浏览器自动化 | Playwright (Python) | 自动执行SKU配对操作 |
| 运行环境 | Windows本地 | 用户主要使用Windows |

### 4.2 为什么选择Playwright而不是API？

| 对比项 | API方案 | Playwright方案 |
|--------|---------|----------------|
| 需要店小秘开放API | ✅ 需要 | ❌ 不需要 |
| 稳定性 | 高 | 中等（网站改版需调整） |
| 开发难度 | 需要API文档 | 直接模拟操作 |
| 适合当前情况 | 不确定API支持 | ✅ 推荐 |

### 4.3 核心流程：自动配对脚本

```python
# 伪代码示意
for order in 未配对订单列表:
    # 1. 从订单中提取信息
    product_code = extract_product_code(order.platform_sku)  # 如 J20
    name1 = order.name1  # 如 Xaviar
    name2 = order.name2  # 如 Suzi
    date = get_today()   # 如 0121
    
    # 2. 生成要搜索的SKU
    search_sku = f"Michael-{product_code}-{date}-{name1}+{name2}"
    
    # 3. 点击"详情" → "配对商品SKU"
    click_order_detail(order)
    click_pair_sku_button()
    
    # 4. 搜索并选择
    input_search(search_sku)
    click_search()
    click_select_first_result()
    
    # 5. 配对完成，处理下一个
```

---

## 五、店小秘操作路径

### 5.1 手动配对流程（当前）

```
1. 进入：订单 → 待审核
2. 找到未配对订单（标记"未配对"）
3. 点击"详情"打开订单详情弹窗
4. 点击"配对商品SKU"链接
5. 在商品搜索页面输入SKU
6. 点击"搜索"
7. 在结果中点击"选择"
8. 配对完成
```

### 5.2 批量建库路径

```
路径：仓库 → 商品管理 → 导入
模板字段：
- *SKU (必填)
- 平台SKU
- 识别码
- 中文名称
- 英文名称
- 分类ID
- 图片URL
- 商品净重(g)
- 采购参考价(RMB)
- ...
```

### 5.3 关键页面URL

| 页面 | URL |
|------|-----|
| 待审核订单 | https://www.dianxiaomi.com/web/order/paid?go=m100 |
| 自定导出 | https://www.dianxiaomi.com/web/orderSetting/export |
| 商品管理 | 待确认 |
| SKU配对 | 待确认 |

---

## 六、交付物清单

### 6.1 脚本文件

| 文件名 | 功能 | 语言 |
|--------|------|------|
| `generate_sku_excel.py` | 解析订单Excel，生成建库Excel | Python |
| `auto_pair_sku.py` | 自动配对SKU的Playwright脚本 | Python |
| `config.json` | 配置文件（卡片对应表等） | JSON |
| `requirements.txt` | Python依赖包列表 | - |

### 6.2 使用文档

| 文档 | 内容 |
|------|------|
| `README.md` | 安装说明、使用方法 |
| `卡片对应表.xlsx` | 卡片代码与店小秘SKU的映射 |

---

## 七、待确认事项

### 7.1 必须确认（阻塞开发）

| # | 事项 | 状态 | 备注 |
|---|------|------|------|
| 1 | 卡片对应表 | ⏳ 待用户提供 | Shopify卡片代码 → 店小秘卡片SKU |
| 2 | 产品编号完整列表 | ⏳ 待确认 | B09, J20, J02 等所有产品编号 |
| 3 | 颜色代码完整列表 | ⏳ 待确认 | B=Black, G=Gold, S=Silver 等 |

### 7.2 可选确认（优化相关）

| # | 事项 | 状态 | 备注 |
|---|------|------|------|
| 4 | 是否需要定时自动运行 | ⏳ 待确认 | Windows计划任务 |
| 5 | 是否需要运行日志 | ⏳ 待确认 | 记录每次配对的结果 |
| 6 | 是否需要错误重试机制 | ⏳ 待确认 | 配对失败时自动重试 |

---

## 八、时间规划

| 阶段 | 任务 | 预计时间 |
|------|------|----------|
| 阶段1 | 收集完整卡片对应表 | 用户提供 |
| 阶段2 | 开发Excel生成脚本 | 1-2小时 |
| 阶段3 | 开发Playwright配对脚本 | 2-3小时 |
| 阶段4 | 测试与调试 | 1-2小时 |
| 阶段5 | 文档与交付 | 0.5小时 |

---

## 九、风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 店小秘页面改版 | 脚本失效 | 模块化设计，便于快速修改 |
| 网络不稳定 | 操作中断 | 添加重试机制和断点续传 |
| SKU搜索无结果 | 配对失败 | 记录失败订单，人工复核 |
| 登录状态失效 | 脚本无法运行 | 保存登录Cookie，支持手动重新登录 |

---

## 十、附录

### 10.1 示例数据

**输入：订单导出Excel**
```
订单号: 5261219-58814
平台SKU: J20-G-engraved-D17-whitebox
Name 1: Xaviar
Name 2: Suzi
Variants: Gold
```

**输出：建库Excel**
```
SKU: Michael-J20-0121-Xaviar+Suzi
中文名称: Michael-J20项链金色-Xaviar+Suzi
英文名称: Michael-J20-0121-Xaviar+Suzi
```

**额外添加：**
```
卡片SKU: Michael-D17-CARD（根据D17对应）
红盒SKU: 无（whitebox不需要）
```

### 10.2 联系方式

如有问题，请随时沟通。

---

**文档结束**
